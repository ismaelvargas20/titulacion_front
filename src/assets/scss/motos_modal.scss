.moto-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(2,6,23,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1200;
  padding: 28px;
  /* permitir scroll táctil del overlay en dispositivos pequeños pero ocultamos
     su scrollbar para que no compita con la scrollbar interna del modal. */
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

/* ocultar la scrollbar del overlay (aplica a WebKit y Firefox) */
.moto-modal-overlay::-webkit-scrollbar { display: none; }
.moto-modal-overlay { scrollbar-width: none; }
.moto-modal {
  background: var(--card-bg, #0f1720);
  color: var(--text, #fff);
  border-radius: 14px;
  width: 100%;
  max-width: 980px;
  display: flex;
  gap: 18px;
  position: relative;
  padding: 18px;
  box-shadow: 0 30px 80px rgba(2,6,23,0.6);
  /* Por defecto no mostramos overflow; en pantallas pequeñas el modal será
     el área scrollable (ver media query). Mantener border-radius para que
     la scrollbar interna se recorte correctamente en el borde. */
  overflow: hidden; /* recortar cualquier contenido que sobresalga y asegurar esquinas redondeadas */
}
.moto-modal .btn { transition: transform 160ms ease, box-shadow 160ms ease, filter 120ms ease; }
.moto-modal .btn.btn-primary {
  background: linear-gradient(90deg, var(--cta-light, #0b73ff), #4fb8ff);
  color: #fff;
  padding: 10px 16px;
  border-radius: 10px;
  box-shadow: 0 12px 30px rgba(11,115,255,0.16);
  font-weight: 800;
}
.moto-modal .btn.btn-primary:hover { transform: translateY(-3px); filter: brightness(0.98); box-shadow: 0 18px 40px rgba(11,115,255,0.18); }
.moto-modal .btn:not(.btn-primary) {
  background: transparent;
  color: var(--text);
  padding: 8px 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.06);
  backdrop-filter: blur(4px);
}
.moto-modal .btn:not(.btn-primary):hover { background: rgba(255,255,255,0.02); transform: translateY(-2px); }

/* Inputs y textarea más vivos */
.moto-modal input, .moto-modal textarea, .sell-form-grid input, .sell-form-grid select {
  transition: box-shadow 160ms ease, border-color 120ms ease, transform 120ms ease;
}
.moto-modal input:focus, .moto-modal textarea:focus, .sell-form-grid input:focus, .sell-form-grid select:focus {
  outline: none;
  border-color: rgba(11,115,255,0.9);
  box-shadow: 0 6px 26px rgba(11,115,255,0.12);
  transform: translateY(-1px);
}

/* Mejor apariencia para el formulario de contacto en el modal */
.modal-contact input, .modal-contact textarea {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.04);
}
.modal-contact-actions .btn.btn-primary { padding: 10px 18px; }
.modal-contact-actions .btn { padding: 10px 14px; }

/* Pequeña animación al abrir el modal */
.moto-modal { transform-origin: center; animation: modalPop 260ms cubic-bezier(.2,.9,.2,1); }
@keyframes modalPop { from { opacity: 0; transform: scale(.98) translateY(6px); } to { opacity: 1; transform: scale(1) translateY(0); } }

/* Remove any residual dark outline/border specifically for the Contactar vendedor button */
.moto-modal .modal-actions .btn.btn-primary {
  border: none !important;
  outline: none !important;
  box-shadow: 0 14px 36px rgba(11,115,255,0.18) !important;
}

/* Remove any residual border/edge on the 'Enviar mensaje' button specifically */
.moto-modal .modal-contact-actions .btn.btn-primary {
  border: none !important;
  outline: none !important;
  box-shadow: 0 12px 32px rgba(11,115,255,0.14) !important; /* soft glow, not black edge */
}
.modal-close {
  position: absolute;
  right: 12px;
  top: 12px;
  /* botón circular con contraste: X blanca sobre fondo semitransparente oscuro */
  background: rgba(0,0,0,0.45);
  border: none;
  color: #ffffff; /* X blanca para verse sobre imágenes oscuras */
  font-size: 1.05rem;
  cursor: pointer;
  width: 36px;
  height: 36px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 999px;
  box-shadow: 0 8px 20px rgba(2,6,23,0.35);
}
.modal-left { flex: 0 0 46%; }
.modal-left img { width: 100%; height: 340px; object-fit: cover; border-radius: 10px; }
.modal-right { flex: 1 1 auto; display: flex; flex-direction: column; gap: 10px; }
.modal-title { margin: 4px 0 2px 0; font-size: 1.25rem; font-weight: 800; }
.modal-meta { display:flex; gap:12px; align-items:center; color: var(--muted); }
.modal-price { background: var(--price-badge-bg, #0b73ff); color: #fff; padding:6px 10px; border-radius:8px; font-weight:800; }
.modal-stars { margin-left: 6px; display:inline-flex; align-items:center; gap:6px; color: var(--muted); font-weight:700; }
.modal-stars .star-icon { color: #ffb400; }
.modal-desc { color: var(--muted); margin-top: 8px; }
.modal-actions { margin-top: 12px; display:flex; gap:12px; align-items:center; }
.modal-contact { margin-top: 12px; display:flex; flex-direction:column; gap:8px; }
.modal-contact label { display:flex; flex-direction:column; font-size:0.95rem; }
.modal-contact input, .modal-contact textarea { margin-top:6px; padding:12px 14px; border-radius:10px; border:1px solid var(--muted-border); background:transparent; color:var(--text); font-size:0.95rem; }
.modal-contact .field { display:flex; flex-direction:column; }
.modal-contact .modal-contact-actions { display:flex; gap:12px; margin-top:12px; align-items:center; }

/* Grid layout for inputs + message */
.modal-contact-grid { display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
.modal-contact-grid .inputs-col { display:flex; flex-direction:column; gap:10px; }
.modal-contact-grid .message-col { display:flex; flex-direction:column; }

/* Make inputs and textarea look elevated */
.modal-contact input:focus, .modal-contact textarea:focus { box-shadow: 0 10px 30px rgba(11,115,255,0.12); border-color: rgba(11,115,255,0.9); transform: translateY(-1px); }

/* Message textarea full height in desktop */
.modal-contact .message-col textarea { height: 100%; min-height: 160px; resize: vertical; }

/* Small helper / hint text */
.modal-contact .hint { font-size:0.85rem; color:var(--muted); margin-top:6px; }

/* Error message */
.contact-error { margin-top:10px; color: #7b1b1b; background: rgba(123,27,27,0.06); border-left: 4px solid #b91c1c; padding:10px 12px; border-radius:8px; font-weight:700; }
.app-main.dark-theme .contact-error { color: #ffd7d7; background: rgba(150,50,50,0.06); border-left-color: rgba(255,120,120,0.2); }

/* Disabled button state */
.modal-contact .btn[disabled] { opacity: 0.7; cursor: not-allowed; filter: saturate(0.98); }

/* Subject input style */
.modal-contact .field input[readonly] { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04); color: var(--muted); padding:10px 12px; border-radius:8px; }

/* Small spinner inside button (text fallback used) */
.btn.loading {
  position: relative;
}
.btn.loading::after {
  content: '';
  width: 16px;
  height: 16px;
  border: 3px solid rgba(255,255,255,0.2);
  border-top-color: #fff;
  border-radius: 50%;
  display: inline-block;
  animation: spin 900ms linear infinite;
  margin-left: 8px;
  vertical-align: middle;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Responsive: stack inputs on small screens */
@media (max-width: 760px) {
  .modal-contact-grid { grid-template-columns: 1fr; }
  .modal-left img { height: 160px; }
}

/* Mejora para móviles: permitir que el modal y su contenido sean scrollables
   sin romper el layout responsive; reduce la altura de la imagen y fuerza
   que el overlay sea scrollable en pantallas pequeñas. */
@media (max-width: 880px) {
  .moto-modal {
    flex-direction: column;
    width: 100%;
    max-width: 720px;
    padding: 12px;
    gap: 12px;
    /* limitar la altura y permitir scroll interno para touch */
    max-height: calc(100vh - 32px);
    overflow: auto; /* la scrollbar ahora pertenece al modal */
    -webkit-overflow-scrolling: touch;
    /* reservar espacio visual para la scrollbar interna y evitar que ésta
       quede pegada al borde redondeado. */
    padding-right: 14px;
  }

  /* asegurarnos que el overlay deje espacio y permita scroll vertical */
  .moto-modal-overlay {
    align-items: flex-start;
    padding-top: 18px;
    padding-bottom: 18px;
  }

  .modal-left { flex: 0 0 auto; width: 100%; }
  .modal-left img { width: 100%; height: 180px; object-fit: cover; border-radius: 8px; }
  /* Forzar que la zona derecha respete los border-radius del contenedor */
  .modal-right { flex: 1 1 auto; overflow: auto; border-top-right-radius: 14px; border-bottom-right-radius: 14px; }

  /* Formularios y textarea deben poder reducir su tamaño en móviles */
  .modal-contact .message-col textarea { min-height: 120px; }

  /* Scrollbar interno del modal (móvil): pista y esquina igual al fondo
     para que no se vea la franja sobre el borde redondeado. */
  .moto-modal::-webkit-scrollbar { width: 12px; }
  .moto-modal::-webkit-scrollbar-track { background: var(--card-bg, #0f1720); }
  .moto-modal::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.12));
    border-radius: 10px;
    border: 3px solid transparent;
    background-clip: padding-box;
  }
  .moto-modal::-webkit-scrollbar-corner { background: var(--card-bg, #0f1720); }
}
.contact-sent { margin-top:8px; color: #b8f0c1; background: rgba(10,80,40,0.08); padding:8px 10px; border-radius:8px; }

@media (max-width: 880px) {
  .moto-modal { flex-direction: column; }
  .modal-left img { height: 220px; }
}

/* Modal: richer visual details */
.modal-desc { margin-top: 8px; color: var(--muted); }
.modal-desc .desc-lead { margin: 0 0 8px 0; color: var(--text); font-weight: 600; }
.modal-features { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
.modal-features .chip { background: linear-gradient(90deg, rgba(11,115,255,0.12), rgba(79,184,255,0.08)); color: var(--primary); padding:6px 10px; border-radius:999px; font-weight:700; font-size:0.85rem; box-shadow: 0 6px 18px rgba(11,115,255,0.06); }
.modal-specs { list-style:none; margin:6px 0 0 0; padding:0; color:var(--muted); display:flex; gap:18px; flex-wrap:wrap; }
.modal-specs li { font-size:0.9rem; }
.desc-note { margin-top:8px; color:var(--muted); }

/* Fix: dropdowns (select) in dark mode were using an unpleasant default background.
   Make selects and their option list coherent with the app dark theme inside modals. */
.app-main.dark-theme .moto-modal select,
.app-main.dark-theme .moto-modal input,
.app-main.dark-theme .moto-modal textarea,
.app-main.dark-theme .sell-modal select,
.app-main.dark-theme .sell-modal input,
.app-main.dark-theme .sell-modal textarea,
.app-main.dark-theme .sell-form-grid select,
.app-main.dark-theme .sell-form-grid input,
.app-main.dark-theme .sell-form-grid textarea {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.06);
  color: var(--text);
  -webkit-appearance: none;
  appearance: none;
}

/* Ensure native option list uses dark background and readable text (works in most browsers) */
.app-main.dark-theme select option {
  background: var(--card-bg, #0f1720);
  color: var(--text, #fff);
}

/* Small tweak: make the select arrow more visible in dark theme (optional) */
.app-main.dark-theme .moto-modal select,
.app-main.dark-theme .sell-modal select {
  background-image: linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.08) 50%), linear-gradient(135deg, rgba(255,255,255,0.08) 50%, transparent 50%);
  background-position: calc(100% - 18px) calc(1em + 2px), calc(100% - 13px) calc(1em + 2px);
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right: 36px; /* leave space for the arrow */
}

/* Make the confirmation message vivid in light mode */
.moto-modal .contact-sent {
  margin-top: 12px;
  background: linear-gradient(90deg, rgba(11,115,255,0.08), rgba(79,184,255,0.06));
  color: #033a66;
  border-left: 4px solid var(--cta-light, #0b73ff);
  padding: 10px 12px;
  border-radius: 8px;
  font-weight: 700;
}

/* Dark theme: keep a green success look */
.app-main.dark-theme .moto-modal .contact-sent {
  background: rgba(10,80,40,0.08);
  color: #b8f0c1;
  border-left-color: rgba(10,160,80,0.4);
}
